<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<metal:main metal:use-macro="templates('Fragments/main.pt').macros['main']">
  <metal:main metal:fill-slot="content">

<script>/* <![CDATA[ */
  function hide_points ()
  {
    $(".points").hide();
    $(".nopoints").show();
  }

  function show_points ()
  {
    $(".points").show();
    $(".nopoints").hide();
  }
  function hide_quantils ()
  {
    $(".quantile").hide();
    $(".noquantile").show();
  }

  function show_quantils ()
  {
    $(".quantile").show();
    $(".noquantile").hide();
  }
/* ]]> */
</script>

<h2>Statistiken für ${exam.name}</h2>

<h3>Punkteverteilung nach Fächern</h3>


<p>Anzeigemodus: <span class="points" style="display:none"><a href="javascript:hide_points()">Nur Diagramme</a> | Punkte und Diagramme</span><span class="nopoints">Nur Diagramme | <a href="javascript:show_points()">Punkte und Diagramme</a></span></p>

<p tal:condition="tutorial_ids">In den Diagrammen entspricht der erste Balken dem Wert in der Übungsgruppe, der zweite Wert dem in der
gesamten Vorlesung. <span class="points">Die Punktedurchschnitte werden in der Form <i>Übungsgruppe/Vorlesung</i> ausgegeben</span></p>

<table class="table" style="width: auto">
  <thead class="thead-dark">
    <th scope="col">Fach</th>
    <th scope="col" tal:repeat="e exam.exercises">${e.nr}</th>
    <th scope="col">Σ</th>
  </thead>
  <tr tal:repeat="subject sorted(statistics_data.keys(), key=lambda x: (x is None, x)).remove('TOTAL')">
    <td>${'(Keine Angabe)' if subject is None else subject}</td>
    <td tal:repeat="e exam.exercises">
      <span tal:define="statistics_data statistics_data[subject][e.id]; statistics_images True" tal:omit-tag="">
        <metal:main metal:use-macro="templates('Fragments/Format/avgstd.pt').macros['avgstd']" />
      </span>
    </td>
    <td>
      <span tal:define="statistics_data statistics_data[subject]['TOTAL']; statistics_images True" tal:omit-tag="">
        <metal:main metal:use-macro="templates('Fragments/Format/avgstd.pt').macros['avgstd']" />
      </span>
    </td>
  </tr>
  <tr class="footerstart">
    <td>Insgesamt</td>
    <td tal:repeat="e exam.exercises">
      <span tal:define="statistics_data statistics_data['TOTAL'][e.id]; statistics_images True" tal:omit-tag="">
        <!-- <metal:main metal:use-macro="templates('Fragments/Format/avgstd.pt').macros['avgstd']" /> -->
      </span>
    </td>
    <td>
      <span tal:define="statistics_data statistics_data['TOTAL'][0]; statistics_images True" tal:omit-tag="">
        <metal:main metal:use-macro="templates('Fragments/Format/avgstd.pt').macros['avgstd']" />
      </span>
    </td>
  </tr>
  <tr>
    <td>Maximalpunktzahl</td>
    <td tal:repeat="e exam.exercises">${e.maxpoints}</td>
    <td>${exam.get_max_points()}</td>
  </tr>
</table>

<div tal:condition="exam.registration or exam.admission" tal:omit-tag="">
  <h3>Zulassung, Anmeldung und Atteste</h3>
  <table>
    <tr>
      <th></th>
      <th tal:condition="tutorial_ids">Übungsgruppe</th>
      <th>Vorlesung</th>
    </tr>
    <tr tal:condition="exam.admission is not None">
      <td>Zugelassen</td>
      <td tal:condition="tutorial_ids">${admission_counts['ADMISSIONS']['TUTORIALS']}</td>
      <td>${admission_counts['ADMISSIONS']['LECTURE']}</td>
    </tr>
    <tr tal:condition="exam.registration is not None">
      <td>Angemeldet</td>
      <td tal:condition="tutorial_ids">${admission_counts['REGISTRATIONS']['TUTORIALS']}</td>
      <td>${admission_counts['REGISTRATIONS']['LECTURE']}</td>
    </tr>
    <tr tal:condition="exam.registration is not None and exam.admission is not None">
      <td>Zugelassen und angemeldet</td>
      <td tal:condition="tutorial_ids">${admission_counts['ADMITTED_AND_REGISTERED']['TUTORIALS']}</td>
      <td>${admission_counts['ADMITTED_AND_REGISTERED']['LECTURE']}</td>
    </tr>
    <tr tal:condition="exam.medical_certificate is not None">
      <td>Attest</td>
      <td tal:condition="tutorial_ids">${admission_counts['MEDICAL_CERTIFICATES']['TUTORIALS']}</td>
      <td>${admission_counts['MEDICAL_CERTIFICATES']['LECTURE']}</td>
    </tr>
  </table>
</div>

<h3>Quantile</h3>
<a role="buton" class="noquantile btn btn-primary" href="javascript:show_quantils()">Anzeigen</a>
<div class="quantile" style="display:none">
<a role="button" class="btn btn-primary" href="javascript:hide_quantils()">Verbergen</a>

<table class="table mt-2 w-auto">
  <thead class="thead-dark">
    <th scope="col">Mindestpunktzahl</th>
    <th scope="col" tal:condition="tutorial_ids">Übungsgruppe</th>
    <th scope="col">Vorlesung</th>
  </thead>
  <tbody>
    <tr tal:repeat="q quantils">
      <td>${q[0]['min_points']} (${int(q[0]['min_percent']*100)}%)</td>
      <td tal:condition="tutorial_ids">${int(q[1]['TUTORIALS']['quantile']*100)}% (${q[1]['TUTORIALS']['count']})</td>
      <td>${int(q[1]['ALL']['quantile']*100)}% (${q[1]['ALL']['count']})</td>
    </tr>
  </tbody>
</table>
</div>

<h3>Histogramme</h3>

<h4>Gesamt</h4>
  <img tal:condition="tutorial_ids" tal:attributes="src request.route_path('exam_histogram_for_exam', exam_id=exam.id, tutorial_ids=tutorial_ids)"/>
  <img tal:attributes="src request.route_path('exam_histogram_for_exam', exam_id=exam.id, tutorial_ids='')"/>

  <div tal:repeat="exercise exam.exercises" tal:omit-tag="">
  <h4>Aufgabe ${exercise.nr}</h4>

  <img tal:condition="tutorial_ids" tal:attributes="src request.route_path('exam_histogram_for_exercise', exercise_id=exercise.id, tutorial_ids=tutorial_ids)"/>
  <img tal:attributes="src request.route_path('exam_histogram_for_exercise', exercise_id=exercise.id, tutorial_ids='')"/>

  </div>
  </metal:main>
</metal:main>
