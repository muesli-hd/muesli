<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<metal:main metal:use-macro="templates('Fragments/main.pt').macros['main']">
  <metal:main metal:fill-slot="content">

    <script tal:condition="freshtoken">
      const copyToClipboard = str => {
        if (! str == "") {
          const el = document.createElement('textarea');
          el.value = str;
          document.body.appendChild(el);
          el.select();
          console.log("Copied JWT Token!")
          document.execCommand('copy');
          document.body.removeChild(el);
        }
      };
    </script>
    <h2>API Keys verwalten</h2>

    <p>
    <a href="../api-explorer" target="_blank" rel="noopener noreferrer"
       title="Link zur Swagger UI">Dokumentation</a> zur API.
    <p>
    Hier k√∂nnen Sie ihre aktuellen API Keys verwalten.
    </p>

    <table class="colored">
    <thead>
      <tr>
        <th> API Key Identifier </th>
        <th> Ablaufdatum </th>
        <th> Beschreibung </th>
        <th> Entfernen </th>
        <th tal:condition="freshtoken"></th>
      </tr>
    <tbody>
      <tr tal:condition="code" tal:repeat="codes code">
        <td style="font-family:monospace;font-size:1.1em;">
            ${codes.id}
        </td>
        <td>
            ${codes.expires}
        </td>
        <td>
            ${codes.description}
        </td>
        <td>
          <form method="post" tal:attributes="action request.route_path('remove_api_key',key_id=codes.id)">
            <input type="submit" value="Entfernen"/>
          </form>
        </td>
        <td tal:condition="freshtoken">
          <button tal:condition="codes.id == max([e.id for e in code])" onClick="copyToClipboard('${freshtoken}')">Kopiere JWT-Token</button>
        </td>
      </tr>
    </tbody>
    </thead>
    </table>
    <br>
    <form action="/user/api_keys" tal:attributes="action request.route_path('user_api_keys')" method="POST">
      <metal:main metal:use-macro="templates('Fragments/HTML/form.pt').macros['formmacro']" />
    </form>

  </metal:main>
</metal:main>
